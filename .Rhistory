tempavg_ind <- lapply(boot_inf, FUN = function(x){n <- NROW(x$ate_boot)
asvec <- unlist(asplit(x$ind_boot, 1))
asarr <- array(asvec, dim = c(nboot, nrow(x$ind_boot)/n ,n))}
apply(asarr, c(1,2), mean))
tempavg_ind <- lapply(boot_inf, FUN = function(x){n <- NROW(x$ate_boot)
asvec <- unlist(asplit(x$ind_boot, 1))
asarr <- array(asvec, dim = c(nboot, nrow(x$ind_boot)/n ,n))
apply(asarr, c(1,2), mean)})
View(tempavg_ind)
View(tempavg_ind[[1]])
length(global_ate_boot)
conf.tempavg.ind <- lapply(tempavg_ind, FUN = function(x)(quantile(x, probs = c(alpha/2, 1- alpha/2))))
View(conf.tempavg.ind[[1]])
conf.tempavg.ind <- lapply(tempavg_ind, FUN = function(x)(apply(x, 2, quantile, probs = c(alpha/2, 1- alpha/2))))
View(conf.tempavg.ind[[1]])
View(conf.tempavg.ind[[2]])
prova <- do.call("rbind", conf.tempavg.ind)
prova <- do.call("cbind", conf.tempavg.ind)
View(prova)
View(conf.tempavg.ind[[1]])
prova <- t(do.call("cbind", conf.tempavg.ind))
View(prova)
View(boot_inf[[1]]$conf.individual)
dim(boot_inf[[1]]$conf.individual)
dim(boot_inf[[1]]$conf.individual[,,1])
View(boot_inf[[1]]$conf.individual[,,1])
which(data_panel$int_date == nint[1], "ID")
unique(data_panel[data_panel$int_date == nint[1], "ID"])
sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"])))
sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"])), simplify = T)
unlist(sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"]))))
rep(c(2,3), each = c(1,2))
mapply(x=c(2,3), y=c(3,4), FUN = function(x,y)(rep(x, each = y)) )
length(nint)
prova <- t(do.call("cbind", conf.tempavg.ind))
View(data.frame(ID = unlist(sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"])))),
int_date = unlist(sapply(x = nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))),
prova))
data.frame(ID = unlist(sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"])))),
int_date = unlist(sapply(x = nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))),
prova)
sapply(x = nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))
sapply(nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))
View(data.frame(ID = unlist(sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, "ID"])))),
int_date = unlist(sapply(nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))),
prova))
length(unlist(sapply(nint, FUN = function(x)(rep(x, each = sum(data_panel$int_date == x))))))
nint
sum(data_panel$int_date == 2019)
unique(data_panel[data_panel$int_date == 2019, c("ID", "int_date")])
conf.tempavg.ind <- lapply(tempavg_ind, FUN = function(x)(apply(x, 2, quantile, probs = c(alpha/2, 1- alpha/2))))
conf.tempavg.ind <- t(do.call("cbind", conf.tempavg.ind))
View(data.frame(unlist(sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, c("ID", "int_date")])))),
conf.tempavg.ind))
sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, c("ID", "int_date")])))
sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, c("ID", "int_date")])), simplify = F)
View(data.frame(do.call("cbind", sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, c("ID", "int_date")])), simplify = FALSE)),
conf.tempavg.ind))
View(data.frame(do.call("rbind", sapply(nint, FUN = function(x)(unique(data_panel[data_panel$int_date == x, c("ID", "int_date")])), simplify = FALSE)),
conf.tempavg.ind))
global_ate
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
# Organizing the dataset with as.PanelMLCM
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data) %in% c("Y", "ID", "year", "int_year"))], y.lag = 1)
# Panel Cross Validation in a staggered setting
pcv <- PanelCrossValidationMulti(data = newdata)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, pcv = pcv)
class(newdata)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, pcv = pcv)
if(!"PanelMLCM" %in% class(data) & any(c(is.null(y), is.null(timevar), is.null(id)))) stop("y or id or timevar are missing with no default")
ck
ck
any(ck)
!(is.null(y) | par %in% colnames(y))
!(is.null(y) | y %in% colnames(y))
is.null(y)
y %in% colnames(y)
y %in% colnames(data)
y
class(y) == "character"
!(is.null(y) | y %in% colnames(data))
as.logical(!(is.null(y) | y %in% colnames(data)))
mapply(list(y, timevar, id), FUN = function(par)(!(is.null(par) | par %in% colnames(data))))
mapply(list(y, timevar, id), FUN = function(par)(!(is.null(par) | par %in% colnames(data))), SIMPLIFY = F)
unlist(mapply(list(y, timevar, id), FUN = function(par)(!(is.null(par) | par %in% colnames(data)))))
ck <- unlist(mapply(list(y, timevar, id), FUN = function(par)(!(is.null(par) | par %in% colnames(data)))))
any(ck)
unlist(c(1,2,3))
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, pcv = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
class(PCV)
class(PCV[[1]])
PCV[[1]]$best
class(PCV[[1]]$best)
any(sapply(PCV, function(x)(!"train" %in% class(x$best))))
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
(!"train" %in% class(PCV) | any(sapply(PCV, function(x)(!"train" %in% class(x$best)))))
!"train" %in% class(PCV)
class(PCV)
"train" %in% class(PCV)
is.null(PCV)
!is.null(PCV)
any(sapply(PCV, function(x)(!"train" %in% class(x$best))))
(!"train" %in% class(PCV) & any(sapply(PCV, function(x)(!"train" %in% class(x$best)))))
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
class(best)
class(best[[1]])
causal$ate
causal$conf.global.ate
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv, y.lag = 2)
causal$ate
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, y.lag = 2)
View(ate_i)
View(ate_i[[1]]$ind_effects)
best$int_2019$method
ate_i[[1]]$ate
View(data_stag)
causal <- MLCM(data = data_stag, int_date = "int_date", y = "Y" , timevar = "year", id = "ID", inf_type = "block", nboot = 10, y.lag = 2)
causal <- MLCM(data = data_stag, int_date = "int_year", y = "Y" , timevar = "year", id = "ID", inf_type = "block", nboot = 10, y.lag = 2)
causal$ate
causal$conf.global.ate
causal$best_method
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
pcv <- PanelCrossValidationMulti(data = newdata)
pcv$int_2019
pcv$int_2020
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, pcv = pcv)
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
best$int_2019
best$int_2020
View(best$int_2019$trainingData)
dim(best$int_2019$trainingData)
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
causal <- MLCM(data = data_stag, int_date = "int_year", y = "Y" , timevar = "year", id = "ID", inf_type = "block", nboot = 10, y.lag = 2)
best$int_2019
dim(best$int_2019$trainingData)
View(best$int_2019$trainingData)
View(data_panel)
View(best$int_2020$trainingData)
dim(best$int_2020$trainingData)
View(data_panel)
dim(data_panel)
dim(data)
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
View(newdata)
colnames(newdata)
colnames(data_stag)
colnames(data)
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
!(names(data) %in% c("Y", "ID", "year", "int_year"))
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data_stag) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
colnames(newdata)
colnames(data_stag)
pcv <- PanelCrossValidationMulti(data = newdata)
pcv$int_2019
pcv$int_2019$best
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, pcv = pcv)
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
causal$ate
causal$conf.global.ate
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
# Organizing the dataset with as.PanelMLCM
newdata <- as.PanelMLCM(y = data_stag[, "Y"], timevar = data_stag[, "year"], id = data_stag[, "ID"],
int_date = data_stag[, "int_year"],
x = data_stag[, !(names(data_stag) %in% c("Y", "ID", "year", "int_year"))], y.lag = 2)
# Panel Cross Validation in a staggered setting
pcv <- PanelCrossValidationMulti(data = newdata)
# ATE estimation
causal <- MLCM(data = newdata, int_date = "int_date", inf_type = "block", nboot = 10, PCV = pcv)
causal$global_ate
class(pcv)
class(pcv[[1]])
names(pcv[[1]])
pcv[[1]]$best.metric
pcv[[1]]$all_methods
newdata <- as.PanelMLCM(y = data[, "Y"], timevar = data[, "year"], id = data[, "ID"],
x = data[, !(names(data) %in% c("Y", "ID", "year"))], y.lag = 1)
# Using the first two years for training and the last two years for testing
indices <- CAST::CreateSpacetimeFolds(newdata, timevar = "Time", k = length(unique(newdata$Time)))
trainx <- indices$indexOut[1:2]
testx <- indices$indexOut[3:4]
ctrl <- trainControl(index = trainx, indexOut = testx)
# Customized panel cross validation
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl)
### Example 2. Changing ML methods and estimating ATE
enet <- list(method = "enet",
tuneGrid = expand.grid(
fraction = seq(0.1, 0.9, by = 0.1),
lambda = seq(0.1, 0.9, by = 0.1)))
linreg <- list(method = "lm",
tuneGrid = expand.grid(
intercept = seq(0, 10, by = 0.5)))
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl,
ML_methods = list(enet, linreg))
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv$best,
nboot = 10, CATE = FALSE)
causal$ate
causal$conf.ate
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv$best,
nboot = 10, CATE = FALSE)
is.null(PCV)
class(PCV)
newdata <- as.PanelMLCM(y = data[, "Y"], timevar = data[, "year"], id = data[, "ID"],
x = data[, !(names(data) %in% c("Y", "ID", "year"))], y.lag = 1)
# Using the first two years for training and the last two years for testing
indices <- CAST::CreateSpacetimeFolds(newdata, timevar = "Time", k = length(unique(newdata$Time)))
trainx <- indices$indexOut[1:2]
testx <- indices$indexOut[3:4]
ctrl <- trainControl(index = trainx, indexOut = testx)
# Customized panel cross validation
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl)
### Example 2. Changing ML methods and estimating ATE
enet <- list(method = "enet",
tuneGrid = expand.grid(
fraction = seq(0.1, 0.9, by = 0.1),
lambda = seq(0.1, 0.9, by = 0.1)))
linreg <- list(method = "lm",
tuneGrid = expand.grid(
intercept = seq(0, 10, by = 0.5)))
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl,
ML_methods = list(enet, linreg))
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv,
nboot = 10, CATE = FALSE)
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv,
nboot = 10, CATE = FALSE)
is.null(PCV)
!"train" %in% class(PCV$best)
any(sapply(PCV, function(x)(!"train" %in% class(x$best))))
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv,
nboot = 10, CATE = FALSE)
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv,
nboot = 10, CATE = FALSE)
!is.null(PCV) & !is.character(int_date) & (!"train" %in% class(PCV$best))
!is.null(PCV)
!is.character(int_date)
(!"train" %in% class(PCV$best))
!is.null(PCV) & is.character(int_date)
if(!is.null(PCV) & is.character(int_date)){if(any(sapply(PCV, function(x)(!"train" %in% class(x$best))))) stop("Invalid PCV method, it should be a list returned from a previous call to 'PanelCrossValidationMulti()' ")}
newdata <- as.PanelMLCM(y = data[, "Y"], timevar = data[, "year"], id = data[, "ID"],
x = data[, !(names(data) %in% c("Y", "ID", "year"))], y.lag = 1)
# Using the first two years for training and the last two years for testing
indices <- CAST::CreateSpacetimeFolds(newdata, timevar = "Time", k = length(unique(newdata$Time)))
trainx <- indices$indexOut[1:2]
testx <- indices$indexOut[3:4]
ctrl <- trainControl(index = trainx, indexOut = testx)
# Customized panel cross validation
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl)
### Example 2. Changing ML methods and estimating ATE
enet <- list(method = "enet",
tuneGrid = expand.grid(
fraction = seq(0.1, 0.9, by = 0.1),
lambda = seq(0.1, 0.9, by = 0.1)))
linreg <- list(method = "lm",
tuneGrid = expand.grid(
intercept = seq(0, 10, by = 0.5)))
pcv <- PanelCrossValidation(data = newdata, int_date = 2019, trControl = ctrl,
ML_methods = list(enet, linreg))
causal <- MLCM(data = newdata, int_date = 2019, inf_type = "classic", PCV = pcv,
nboot = 10, CATE = FALSE)
causal$ate
causal$conf.ate
causal$ate
causal$conf.ate
class(as.Date("2018-10-06"))
18.66/2
8.6*2
19.60-18.66
0.94/19.60
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, y.lag = 2)
# ATE
fit$ate
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, y.lag = 2)
# ATE
fit$ate
fit$conf.ate
# Individual effects
head(fit$ind.effects)
head(fit$conf.individual)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
names(fit)
colnames(x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
colnames(data_panel)
colnames(x.cate)
cate_effects <- cate_est(data = data_panel, int_date = int_date, ind_effects = ind_effects, x.cate = x.cate, nboot = nboot, alpha = alpha)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
colnames(data_cate)
colnames(x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
colnames(x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
x.cate <- check_xcate(x.cate = x.cate, data = data, id = id, timevar = timevar)
colnames(x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
View(x.cate)
# Simulating time-varying external regressors
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
colnames(x.cate)
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
x.cate <- cbind(ID = rep(1:100, each = 2), year = rep(2019:2020, times = 100), x1 = rnorm(200),
x2 = 2*rnorm(200), x3 = sample(1:5, size = 200, replace = TRUE))
# Estimation
fit <- MLCM(data = data, y = "Y", timevar = "year", id = "ID", int_date = 2019,
inf_type = "classic", nboot = 10, CATE = TRUE, y.lag = 2, x.cate = x.cate)
# CATE
fit$cate.inf
library(devtools)
# Assume the following intervention dates
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
fit <- MLCM(data = data_stag, y = "Y", timevar = "year", id = "ID", int_date = "int_year",
inf_type = "block", nboot = 10, y.lag = 2)
fit$global_ate
names(fit)
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
data_stag <- data.frame(int_year, data)
View(data_stag)
fit <- MLCM(data = data_stag, y = "Y", timevar = "year", id = "ID", int_date = "int_year",
inf_type = "block", nboot = 10, y.lag = 2)
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
# Estimation
fit <- MLCM(data = data_stag, y = "Y", timevar = "year", id = "ID", int_date = "int_year",
inf_type = "block", nboot = 10, y.lag = 2)
class(ate_i)
lenght(ate_i)
length(ate_i)
ate_i[[1]]$ate
View(ate_i[[1]]$ind_effects)
colMeans(ate_i[[1]]$ind_effects)
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
# Estimation
fit <- MLCM(data = data_stag, y = "Y", timevar = "year", id = "ID", int_date = "int_year",
inf_type = "block", nboot = 10, y.lag = 2)
boot_inf[[1]]$conf.ate
View(boot_inf[[1]]$ate_boot)
View(ta_ind_effects)
colMeans(ta_ind_effects[ta_ind_effects$int_date == 2019])
colMeans(ta_ind_effects[ta_ind_effects$int_date == 2019,])
colMeans(ta_ind_effects[ta_ind_effects$int_date == 2020,])
ate_i[[1]]$ate
global_ate
mean(ta_ind_effects$temp.avg)
names(ate_i) <- paste0("int_", nint)
names(ate_i)
names(boot_inf) <- paste0("int_", nint)
int_year_i <- c(rep(2019, times = 60), rep(2020, times = 40))
int_year <- rep(int_year_i, each = length(unique(data$year)))
# Define data_stag
data_stag <- data.frame(int_year, data)
# Estimation
fit <- MLCM(data = data_stag, y = "Y", timevar = "year", id = "ID", int_date = "int_year",
inf_type = "block", nboot = 10, y.lag = 2)
fit$global_ate
fit$group_ate$int_2019$ate
fit$group_ate$int_2020$ate
(80.02975 + 61.31385 - 106.4981)/3
(80.02975 + (61.31385 - 106.4981)/2)/3
((80.02975 - 106.4981)/2) + 61.31385)/3
(((80.02975 - 106.4981)/2) + 61.31385)/3
mean(sapply(fit$group_ate, FUN = function(x)(mean(x$ate))))
((80.02975 + 61.31385)/2 - 106.4981 )/2
sapply(fit$group_ate, FUN = function(x)(x$ate))
unlist(sapply(fit$group_ate, FUN = function(x)(x$ate)))
sum(unlist(sapply(fit$group_ate, FUN = function(x)(x$ate))))/6
sum(unlist(sapply(fit$group_ate, FUN = function(x)(x$ate))))
identical(fit$global_ate, mean(sapply(fit$group_ate, FUN = function(x)(mean(x$ate)))))
View(fit$tempavg_ind_effects)
View(fit$group_ate$int_2019$ind_effects)
View(fit$group_ate$int_2020$ind_effects)
head(colMeans(fit$group_ate$int_2019$ind_effects),10)
head(colMeans(fit$group_ate$int_2019$ind_effects[, "2019"]),10)
head(colMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")]),10)
head(rowMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")]),10)
head(fit$tempavg_ind_effects[,2])
head(fit$tempavg_ind_effects[,"temp.avg"])
temp_avg_individual_effects <- fit$tempavg_ind_effects[,"temp.avg"]
mean_ind_effects <- fit$group_ate$int_2019$ind_effects[, c("2019", "2020")]
identical(temp_avg_individual_effects, mean_ind_effects)
head(temp_avg_individual_effects)
head(mean_ind_effects)
temp_avg_individual_effects <- fit$tempavg_ind_effects[,"temp.avg"]
mean_ind_effects <- rowMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")])
identical(temp_avg_individual_effects, mean_ind_effects)
head(mean_ind_effects)
head(temp_avg_individual_effects)
temp_avg_individual_effects <- fit$tempavg_ind_effects[,"temp.avg"]
mean_ind_effects <- rowMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")])
all_equal(temp_avg_individual_effects, mean_ind_effects)
temp_avg_individual_effects <- fit$tempavg_ind_effects[,"temp.avg"]
mean_ind_effects <- rowMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")])
all.equal(temp_avg_individual_effects, mean_ind_effects)
temp_avg_individual_effects <- fit$tempavg_ind_effects[fit$tempavg_ind_effects==2019,"temp.avg"]
temp_avg_individual_effects <- fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date==2019,"temp.avg"]
temp_avg_individual_effects <- fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2019,"temp.avg"]
mean_ind_effects <- rowMeans(fit$group_ate$int_2019$ind_effects[, c("2019", "2020")])
identical(temp_avg_individual_effects, mean_ind_effects)
temp_avg_individual_effects <- fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2020,"temp.avg"]
mean_ind_effects <- fit$group_ate$int_2020$ind_effects[, "2020"]
identical(temp_avg_individual_effects, mean_ind_effects)
length(fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2019, "temp.avg"])
mean(fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2019, "temp.avg"])
mean(fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2020, "temp.avg"])
(70.6718 -106.4981)/2
fit$global_ate
mean(fit$tempavg_ind_effects$temp.avg)
unit_avg_effect_coorte1 <- mean(fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2019, "temp.avg"])
unit_avg_effect_coorte2 <- mean(fit$tempavg_ind_effects[fit$tempavg_ind_effects$int_date == 2020, "temp.avg"])
(unit_avg_effect_coorte1 + unit_avg_effect_coorte2)/2
fit$global_ate
